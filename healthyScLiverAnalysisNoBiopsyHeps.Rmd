---
title: "Analysis of healthy liver tissue - take 2"
output: html_notebook
---

An updated map of healthy liver tissue with no hepatocytes from the biopsy samples.

```{r}
library(Seurat)
library(dplyr)
```


```{r}
sobj <- readRDS("~/Dropbox/Zoe/scf_version/analysis/healthy_sc/seurat_objects/dropletQC_filtered/allIntegrated_kanchor5_noBiopsyHeps_dropletQCFiltered.RDS")
```

```{r}
Idents(sobj) <- "integrated_snn_res.0.4"
DimPlot(sobj, label = TRUE)
```

```{r}
DimPlot(sobj, group.by = "orig.ident")
```


```{r}
DimPlot(sobj, group.by = "scina_labels", label = TRUE)
```

Find markers

```{r}
all.markers <- FindAllMarkers(sobj, only.pos = TRUE, min.pct = 0.25, logfc.threshold = 0.25,
                              assay = "SCT", slot = "counts", recorrect_umi = FALSE)
# Remove mikado genes if desired
all.markers2 <- all.markers[!grepl("mikado", all.markers$gene),]
top.markers <- all.markers %>% group_by(cluster) %>% top_n(n = 10, wt = avg_log2FC)
top.sorted <- top.markers[order(as.numeric(as.character(top.markers$cluster))), ]
top.sorted
```

Save markers

```{r}
write.table(all.markers2, 
            file = "~/Dropbox/Zoe/scf_version/analysis/healthy_sc/seurat_objects/dropletQC_filtered/allMarkers_allIntegrated_kanchor5_noBiopsyHeps_dropletQCFiltered_res1.2.tsv",
            sep = "\t", row.names = FALSE, col.names = TRUE, quote = FALSE)
```


```{r}
top3 <- all.markers %>% group_by(cluster) %>% top_n(n = 3, wt = avg_log2FC)
DoHeatmap(sobj, features = top3$gene, slot = "data")
```



```{r}
FeaturePlot(sobj, c("nuclear_fraction", "percent.mt"))
```


### T cells

Looks like there are a few main clusters of T-cells. The largest cluster appears mainly to be CD8A+ T-cells. The top of that cluster is LEF1+/TCF7+. Cluster 6 may be NK cells, as these are XCL1;XCL2+/KLRB1+.

```{r}
FeaturePlot(sobj, features = c("CD3E","GIMAP7","NKG7","CD8A")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

```{r}
FeaturePlot(sobj, features = c("TOX","XCL1;XCL2","LEF1","IL7R-1")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

```{r}
FeaturePlot(sobj, features = c("NXF2;NXF2B;NXF5","KLRB1","TCF7","CTLA4")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

### Macrophages/Monocytes

MARCO+ macrophages appear to make up cluster 4. HLA+ macrophages are cluster 5, but there is some subtyping within there. HCK+/MAL+ macs are on the right, and there is more HLA on the left/middle stem sticking out (labeled as dendritic cells). S100A8+ macs/monocytes are cluster 3. There don't appear to be any DEFA+ macs (only a few cells); suggests true disease-association.

```{r}
FeaturePlot(sobj, features = c("MARCO","CD5L","FER","MSR1")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

```{r}
FeaturePlot(sobj, features = c("LGALS1","TYROBP","HCK","MAL")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

```{r}
FeaturePlot(sobj, features = c("S100A8","S100A9","LYZ-1","DEFA6;DEFA4;DEFA5-1")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

```{r}
FeaturePlot(sobj, features = c("S100A6","HLA-DPB1-1","CD74","RETN")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

### Endothelial cells

All LSECs and endothelial cells appear to be in cluster 1, 15 and maybe cluster 7; the bottom of cluster 1 is likely CV endothelial cells (RSPO3+); cluster 15 is likely vascular endothelial cells (CD34+/MECOM+)

```{r}
FeaturePlot(sobj, features = c("CLEC4G","CTSV;CTSL","DNASE1L3","STAB2")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

```{r}
FeaturePlot(sobj, features = c("RSPO3","WNT2","CD34","MECOM")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

### Plasma cells

All clearly the lower part of cluster 11

```{r}
FeaturePlot(sobj, features = c("JCHAIN","MZB1","DERL3","IGLL5-1")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

### B cells

This is the top blob of cluster 11

```{r}
FeaturePlot(sobj, features = c("CD79B","BANK1","MS4A1","PAX5")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

### Cholangiocytes

Cluster 16. Maybe 18??

```{r}
FeaturePlot(sobj, features = c("KRT19","SLC4A4","KRT18","CLDN10")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

### Mesenchymal cells

Cluster 14.

```{r}
FeaturePlot(sobj, features = c("HHIP","COL1A2","IGFBP7","DCN")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

### Mast cells

It looks like there are none of these exist but there are a few cells in cluster 3

```{r}
FeaturePlot(sobj, features = c("FCER1A","Prss29","MS4A2","Prss34")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

### Dividing

I think it's the right blob of cluster 8?

```{r}
FeaturePlot(sobj, features = c("TOP2A","STMN1","MKI67","BRCA2")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

### Erythrocytes

None - yay!!

```{r}
FeaturePlot(sobj, features = c("HBD;HBB","HBA2;HBA1","ALAS2","ISCA1")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

### Dendritic cells

Maybe a bit of signal on the left of cluster 5.

```{r}
FeaturePlot(sobj, features = c("CST3","IFI30","PLBD1","PLD4")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

### Hepatocytes

Lots of background, as expected, lots coming from L212 TLH. Clusters 9,10,12 are hepatocytes. Periportal and pericentral signals are not clear without subclustering.

```{r}
FeaturePlot(sobj, features = c("ALB-1","APOA1","APOC3","APOE")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

```{r}
FeaturePlot(sobj, features = c("CYP2E1","FETUB","PCK1","C8G")) & 
  NoLegend() &
  FontSize(x.text = 5, y.text = 5, x.title = 8, y.title = 8, main = 10)
```

